(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cardBoard/arrangeStorage/arrangeStorage"],{"381b":function(t,e,a){"use strict";a.r(e);var o=a("de59"),n=a.n(o);for(var r in o)"default"!==r&&function(t){a.d(e,t,function(){return o[t]})}(r);e["default"]=n.a},"517e":function(t,e,a){"use strict";var o=a("7138"),n=a.n(o);n.a},"5a1c":function(t,e,a){"use strict";var o,n=function(){var t=this,e=t.$createElement;t._self._c},r=[];a.d(e,"b",function(){return n}),a.d(e,"c",function(){return r}),a.d(e,"a",function(){return o})},7138:function(t,e,a){},7957:function(t,e,a){"use strict";a.r(e);var o=a("5a1c"),n=a("381b");for(var r in n)"default"!==r&&function(t){a.d(e,t,function(){return n[t]})}(r);a("517e");var i,s=a("f0c5"),c=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);e["default"]=c.exports},aa4c:function(t,e,a){"use strict";(function(t){a("628f"),a("921b");o(a("66fd"));var e=o(a("7957"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},de59:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(a("a34a")),n=i(a("2464")),r=a("2f62");function i(t){return t&&t.__esModule?t:{default:t}}function s(t){return d(t)||u(t)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function u(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function d(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}function l(t,e,a,o,n,r,i){try{var s=t[r](i),c=s.value}catch(u){return void a(u)}s.done?e(c):Promise.resolve(c).then(o,n)}function f(t){return function(){var e=this,a=arguments;return new Promise(function(o,n){var r=t.apply(e,a);function i(t){l(r,o,n,i,s,"next",t)}function s(t){l(r,o,n,i,s,"throw",t)}i(void 0)})}}function h(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},o=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),o.forEach(function(e){p(t,e,a[e])})}return t}function p(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var m=function(){return a.e("components/color-ui-dialog/color-ui-dialog").then(a.bind(null,"43f7"))},N=function(){return Promise.all([a.e("common/vendor"),a.e("components/z-table/z-table")]).then(a.bind(null,"717c"))},g=function(){return a.e("components/uni-icon/uni-icon").then(a.bind(null,"6203"))},I=function(){return a.e("components/searchForm/searchDataList.vue").then(a.bind(null,"a99d"))},_=function(){return a.e("components/uni-popup/uni-popup").then(a.bind(null,"ad32"))},b={originalStationNo:"",originalBoardCard:"",workNo:"",cardBoardNo:"",kuNo:""},w={name:"inStorage",mixins:[n.default],components:{zTable:N,searchForm:I,uniPopup:_,uniIcon:g,alertBox:m},data:function(){return{tempOrderNoList:[],tempNewCardBoardData:[],dataSource:[],currentAction:"",toShowModal:!1,msgContent:"",currentSelectItem:{},currentSelect:"line",originalBoardCardList:[],scanType:"",tableHeight:400,errorContent:"暂无数据",cardBoardNoInfoData:[],cardBoardNoInfoColumns:[{key:"ap_CardNo",title:"卡板号",width:200},{key:"ap_OrderNo",title:"工单号",width:200},{key:"ap_StationNo",title:"库位",width:145},{key:"ap_ArtID",title:"纸质",width:200},{key:"ap_Size",title:"规格",width:200},{key:"ap_Qty",title:"数量",width:145},{key:"ap_CustName",title:"客户",width:400},{title:"操作",listenerClick:!0,width:130,titleAlign:"center",columnAlign:"center",format:{template:"删除",names:[]}}],formItem:Object.assign({},b)}},onReady:function(){this.messageRegister(),this.getTableHeight()},methods:h({checkKuNo:function(){var t=f(o.default.mark(function t(){var e;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.checkKuNoIsExist(this.formItem.kuNo);case 2:if(e=t.sent,e){t.next=6;break}return this.formItem.kuNo="",t.abrupt("return");case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),setSearchDataListSource:function(t){this.currentSelect=t,this.$refs["searchForm"].isShowSearchList=!0,"LicensePlate"===t&&(this.dataSource=this.originalBoardCardList,this.$refs["searchForm"].dataSourceList=this.originalBoardCardList)},getSelectDataInfo:function(t){switch(this.currentSelect){case"LicensePlate":this.formItem.originalBoardCard=t.ct_Desc,this.cardBoardNoInfoData=[],this.filterSelectedData();break;default:break}},filterSelectedData:function(){this.cardBoardNoInfoData=s(this.tempNewCardBoardData);var t=this.formItem.originalBoardCard,e=this.tempOrderNoList.filter(function(e){return e.ap_CardNo+" / "+e.ap_Qty==t});e.length>0&&this.pushDataIntoWorkNoList(e),this.reSetData()},reSetData:function(){this.formItem.originalBoardCard="",this.formItem.workNo="",this.originalBoardCardList=[],this.tempNewCardBoardData=s(this.cardBoardNoInfoData)},comfirmModal:function(t){switch(this.toShowModal=!1,this.currentAction){case"preSubmitDataList":this.submitAddList();break;case"deleteDetailItem":this.deleteDetailItem();break;default:break}},cancelModal:function(t){this.toShowModal=!1},preSubmitDataList:function(){this.currentAction="preSubmitDataList",this.msgContent="确定更改库位吗?",this.toShowModal=!0},submitAddList:function(){var e={Type:"B",cardNo:this.formItem.cardBoardNo,newStationNo:this.formItem.kuNo,UserID:this.$store.getters.userInfo_getters,list:this.cardBoardNoInfoData};this.$store.dispatch("setStationNoAction",e).then(function(e){t.showModal({title:"提示",content:"更改库位成功",showCancel:!1,success:function(e){e.confirm&&t.navigateTo({url:"./arrangeStorage"})}})}).catch(function(e){t.showToast({title:"操作失败:"+e,icon:"none",duration:2e3})})},deleteDetailItem:function(){var t=this,e=this.cardBoardNoInfoData.findIndex(function(e){return e.ap_OrderNo==t.currentSelectItem.ap_OrderNo});-1!=e&&this.cardBoardNoInfoData.splice(e,1)},onClickRowEvent:function(t){this.currentSelectItem=t,this.currentAction="deleteDetailItem",this.msgContent="确定删除当前数据吗?",this.toShowModal=!0},pushDataIntoriginalBoardCardList:function(t){var e=this;t.map(function(t){var a=e.originalBoardCardList.findIndex(function(e){return e.type==t.ap_CardNo});if(-1==a){var o={type:t.ap_CardNo,ct_Desc:t.ap_CardNo+" / "+t.ap_Qty};e.originalBoardCardList.push(o),e.formItem.originalBoardCard=o.ct_Desc}})},pushDataIntoWorkNoList:function(t){var e=this;t.forEach(function(t){var a={ID1:t.ID1,ap_OrderNo:t.ap_OrderNo,ap_StationNo:t.ap_StationNo,ap_ArtID:t.ap_ArtID,ap_Size:t.ap_Size,ap_Qty:t.ap_Qty,ap_CustName:t.ap_CustName,ap_InitNum:t.ap_InitNum,ap_Line:t.ap_Line,ap_LineName:t.ap_LineName,ap_MinSize:t.ap_MinSize,ap_CardNo:t.ap_CardNo,ap_ClassNo:t.ap_ClassNo,ap_ClassNoName:t.ap_ClassNoName,ap_CustID:t.ap_CustID,ap_PCNo:t.ap_PCNo,ap_Status:t.ap_Status,ap_ZoneName:t.ap_ZoneName},o=e.cardBoardNoInfoData.findIndex(function(e){return e.ap_OrderNo==t.ap_OrderNo&&e.ap_CardNo==t.ap_CardNo});-1==o&&e.cardBoardNoInfoData.push(a)})},handleMutilCardBoardSelect:function(t){var e=this.originalBoardCardList.length;e>1?this.setSearchDataListSource("LicensePlate"):(this.pushDataIntoWorkNoList(t),this.reSetData())},addWorkNoInfo:function(){var e=this;if(""==this.formItem.cardBoardNo)return t.showToast({title:"请先扫描卡板号",icon:"none",duration:2e3}),void(this.formItem.workNo="");if(""!=this.formItem.workNo){var a={procName:"spGetPaperScanInfoForOrder",params:{OrderNo:this.formItem.workNo}};this.dataIsLoadding=!0,this.$store.dispatch("getExecuteDropDownAction",a).then(function(t){t&&t.list.length>0&&(e.pushDataIntoriginalBoardCardList(t.list),e.tempOrderNoList=t.list,e.handleMutilCardBoardSelect(t.list)),e.dataIsLoadding=!1}).catch(function(a){t.showToast({title:"获取数据失败:"+a,icon:"none",duration:2e3}),e.dataIsLoadding=!1})}else t.showToast({title:"请输入或扫描工单号",icon:"none",duration:2e3})},getTableHeight:function(){var t=f(o.default.mark(function t(){var e,a,n,r;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this,a=e.setTableHeight(),t.next=4,e.getOtherContentHeight("elForm");case 4:return n=t.sent,t.next=7,e.getOtherContentHeight("elBtn");case 7:r=t.sent,null!=n&&null!=r&&(e.tableHeight=a-n-r-20);case 9:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},(0,r.mapActions)(["getBoardDetailsAction","scanCardArrangeAction","scanJobNoArrangeAction","getExecuteDropDownDetailsAction"]),{messageRegister:function(){},getCardBoardNoInfo:function(){this.doAction()},doAction:function(){var e=this;if(""!=this.formItem.cardBoardNo){var a={procName:"spGetCardInfoForAPP",params:{CardNo:this.formItem.cardBoardNo,Type:"B"}};this.cardBoardNoInfoData=[],this.dataIsLoadding=!0,this.getExecuteDropDownDetailsAction(a).then(function(t){t&&t.list&&t.list.length>0&&(e.cardBoardNoInfoData=t.list,e.tempNewCardBoardData=t.list),e.dataIsLoadding=!1}).catch(function(a){t.showToast({title:"获取数据失败:"+a,icon:"none",duration:2e3}),e.dataIsLoadding=!1})}else t.showToast({title:"请输入或扫描卡板号",icon:"none",duration:2e3})},turnOnScanCode:function(e){this.scanType=e;var a=this;t.scanCode({scanType:"barCode",success:function(t){switch(e){case"cardBoardNo":a.formItem.cardBoardNo=t.result,a.getCardBoardNoInfo();break;case"kuNo":a.formItem.kuNo=t.result;break;case"workNo":a.formItem.workNo=t.result,a.addWorkNoInfo();break;default:break}}})}})};e.default=w}).call(this,a("6e42")["default"])}},[["aa4c","common/runtime","common/vendor"]]]);