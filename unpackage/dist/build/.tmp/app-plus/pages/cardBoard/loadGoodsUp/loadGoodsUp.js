(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cardBoard/loadGoodsUp/loadGoodsUp"],{"0684":function(t,o,e){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var r=a(e("a34a")),n=a(e("2464"));e("2f62");function a(t){return t&&t.__esModule?t:{default:t}}function i(t,o,e,r,n,a,i){try{var s=t[a](i),c=s.value}catch(d){return void e(d)}s.done?o(c):Promise.resolve(c).then(r,n)}function s(t){return function(){var o=this,e=arguments;return new Promise(function(r,n){var a=t.apply(o,e);function s(t){i(a,r,n,s,c,"next",t)}function c(t){i(a,r,n,s,c,"throw",t)}s(void 0)})}}var c=function(){return e.e("components/color-ui-dialog/color-ui-dialog").then(e.bind(null,"43f7"))},d=function(){return Promise.all([e.e("common/vendor"),e.e("components/z-table/z-table")]).then(e.bind(null,"717c"))},h=function(){return e.e("components/uni-icon/uni-icon").then(e.bind(null,"6203"))},u=function(){return e.e("components/searchForm/searchDataList.vue").then(e.bind(null,"a99d"))},l=function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"ad32"))},f={cardBoardNo:"",carGoodsNo:"",hoverport:""},m={name:"loadGoodsUp",mixins:[n.default],components:{zTable:d,uniPopup:l,searchForm:u,uniIcon:h,alertBox:c},data:function(){return{hasLoadGoodsDone:!1,saveBtnTitle:"未完成",carNoList:[],carNoItem:{},editItem:{loadCarNo:"",hoverport:"",hoverportID:""},hoverportList:[],scanCard:{},currentAction:"",currentSelect:"hoverportList",dataSource:[],toShowModal:!1,msgContent:"",scanType:"",tableHeight:400,errorContent:"暂无数据",cardBoardNoInfoData:[],cardBoardNoInfoClone:{},cardBoardNoInfoColumns:[{key:"OrderNo",title:"工单号",width:180},{key:"Qty",title:"需装数",width:100},{key:"ScanQty",title:"扫描数",width:100},{key:"CustName",title:"客户",width:180},{key:"StationNo",title:"库位",width:180},{key:"ArtID",title:"纸质",width:160},{key:"Size",title:"规格",width:160},{key:"MinSize",title:"小尺寸",width:160},{key:"ZoneName",title:"地区",width:100},{title:"操作",listenerClick:!0,width:80,titleAlign:"center",columnAlign:"center",format:{template:"详细",names:[]}}],formItem:Object.assign({},f),catchFlag:!1,cardScanQtyItems:{}}},watch:{cardBoardNoInfoData:{handler:function(t,o){this.checkIsDoneOrNot()},immediate:!0,deep:!0}},computed:{canScanCode:function(){return!(this.cardBoardNoInfoData.length>0&&""!=this.formItem.hoverport)},canSubmitHoverport:function(){return!(""!=this.editItem.loadCarNo&&""!=this.editItem.hoverport)},canGetloadCarNo:function(){return!(0==this.cardBoardNoInfoData.length)},canSaveData:function(){return 0==this.cardBoardNoInfoData.length},canSelectHoverport:function(){return!(""!=this.formItem.carGoodsNo&&""==this.formItem.hoverport)}},onReady:function(){this.messageRegister(),this.getTableHeight()},methods:{preSelectHoverport:function(){this.currentAction="preSelectHoverport",this.msgContent="选择码头后不可更改,确定选择吗?",this.toShowModal=!0},preCompetitionForOrders:function(){this.currentAction="preCompetitionForOrders",this.msgContent="抢单后不可回退,确定抢单吗?",this.toShowModal=!0},preSubmitDataList:function(){this.currentAction="preSubmitDataList",this.msgContent="确定提交数据吗?",this.toShowModal=!0},messageRegister:function(){this.loadDataByUser()},loadDataByUser:function(){var o={procName:"spGetChoiceInfo",params:{UserID:this.$store.getters.userInfo_getters}},e=this;this.$store.dispatch("getMultipleResultsAction",o).then(function(t){null!=t&&(e.cardBoardNoInfoData=t.cardDetailList,e.editItem.loadCarNo=t.master.CarListNo,e.formItem.carGoodsNo=t.master.CarListNo,e.formItem.hoverport=t.master.PierName)}).catch(function(o){t.showToast({title:"加载备货列表失败:"+o,icon:"none",duration:2e3})})},checkIsDoneOrNot:function(){this.hasLoadGoodsDone=!1,this.cardBoardNoInfoData.length>0&&(this.hasLoadGoodsDone=this.cardBoardNoInfoData.every(function(t){return null!=t.Qty&&t.Qty==t.ScanQty})),this.hasLoadGoodsDone&&(this.saveBtnTitle="已完成")},competitionForOrders:function(){var o={procName:"spGetLoadCarNoListForAPP",params:{UserID:this.$store.getters.userInfo_getters,carGoodsNo:this.editItem.loadCarNo,hoverport:this.editItem.hoverport}};this.$store.dispatch("getExecuteDropDownAction",o).then(function(o){o&&t.showToast({title:"抢单成功",icon:"none",duration:2e3})}).catch(function(o){t.showToast({title:"抢单失败:"+o,icon:"none",duration:2e3})})},loadFirstCarGoodsNo:function(){var o={procName:"spGetGrabOrder",params:{UserID:this.$store.getters.userInfo_getters}},e=this;this.$store.dispatch("getBoardDetailsAction",o).then(function(o){o&&o.list&&o.list.length>0?(e.formItem.carGoodsNo=o.list[0].CarListNo,e.loadDataByUser()):t.showToast({title:"暂无装车单号!",icon:"none",duration:2e3})}).catch(function(o){t.showToast({title:"获取装车单号失败:"+o,icon:"none",duration:2e3})})},loadCarGoodsNoList:function(){var o=this,e={procName:"spGetLoadCarNoListForAPP",params:{UserID:this.$store.getters.userInfo_getters}},r=this;this.$store.dispatch("getExecuteDropDownAction",e).then(function(t){if(t&&t.list&&t.list.length>0){var e=t.list.map(function(t){var o={type:t.LoadNo,ct_Desc:t.LoadNo};return o});r.carNoList=e,o.setEditItemDefaultValue()}}).catch(function(o){t.showToast({title:"获取装车单号失败:"+o,icon:"none",duration:2e3})})},setEditItemDefaultValue:function(){this.carNoList.length>0&&(this.carNoItem=this.carNoList[0],this.formItem.carGoodsNo=this.carNoItem.ct_Desc,this.editItem.loadCarNo=this.carNoItem.ct_Desc,this.getCardBoardNoInfo())},getCardBoardNoInfo:function(){var o=this;if(this.cardBoardNoInfoData=[],""!=this.formItem.carGoodsNo){var e={procName:"spGetPaperCarListInfoForAPP",params:{UserID:this.$store.getters.userInfo_getters,CarListNo:this.formItem.carGoodsNo}};this.$store.dispatch("getExecuteDropDownDetailsAction",e).then(function(e){e&&e.list.length>0?(o.cardBoardNoInfoData=e.list,o.cardBoardNoInfoData.forEach(function(t,e){o.cardBoardNoInfoClone[t.OrderNo]=t})):t.showToast({title:"没有该卡板对应的数据",icon:"none",duration:2e3})}).catch(function(o){t.showToast({title:"获取清单数据失败:"+o,icon:"none",duration:2e3})})}},openCarNolist:function(){this.openPopup(),this.loadHoverportList()},openPopup:function(){this.$refs.popup.open()},closePopup:function(){this.$refs.popup.close()},submitDataList:function(){this.saveDataInToPenddingOrDone()},saveDataInToPenddingOrDone:function(){var o={procName:"spSaveFinishForChoice",params:{UserID:this.$store.getters.userInfo_getters,CarListNo:this.formItem.carGoodsNo}},e=this;this.$store.dispatch("getBoardDetailsAction",o).then(function(o){o&&o.list&&o.list.length>0&&(1===o.list[0].Error?t.showToast({title:"提交数据失败:"+o.list[0].Result,icon:"none",duration:2e3}):(e.formItem=Object.assign({},f),e.cardBoardNoInfoData=[],t.showToast({title:"提交数据成功",icon:"none",duration:2e3})))}).catch(function(o){t.showToast({title:"获取装车单号失败:"+o,icon:"none",duration:2e3})})},onClickCheck:function(t){},onClickRowEvent:function(o){t.navigateTo({url:"./loadGoodsUpDetail?detailId=".concat(o.ID1,"&orderNo=").concat(o.OrderNo,"&cardNo=").concat(o.CardNo,"&scanQty=").concat(o.ScanQty)})},loadHoverportList:function(){var o={},e=this;this.$store.dispatch("getHoverportListAction",o).then(function(t){if(t&&t.length>0){var o=t.map(function(t){var o={type:t.al_Code,ct_Desc:t.al_Name};return o});e.hoverportList=o}}).catch(function(o){t.showToast({title:"获取码头列表失败:"+o,icon:"none",duration:2e3})})},getSelectDataInfo:function(t){switch(this.currentSelect){case"hoverportList":this.editItem.hoverport=t.ct_Desc,this.editItem.hoverportID=t.type;break;default:break}},setSearchDataListSource:function(){this.$refs["searchForm"].isShowSearchList=!0,this.$refs["searchForm"].dataSourceList=this.hoverportList,this.dataSource=this.hoverportList},handleDataWhenGotHoverport:function(){this.confirmSelectHoverport()},confirmSelectHoverport:function(){var o={procName:"spSavePierInfo",params:{CarListNo:this.editItem.loadCarNo,PierNo:this.editItem.hoverportID}},e=this;this.$store.dispatch("getBoardDetailsAction",o).then(function(o){o&&o.list&&o.list.length>0&&(0==o.list[0].Error?(e.formItem.hoverport=e.editItem.hoverport,e.closePopup(),t.showToast({title:"选择码头成功",icon:"none",duration:2e3})):t.showToast({title:"选择码头失败:"+o.list[0].Result,icon:"none",duration:2e3}))}).catch(function(o){t.showToast({title:"选择码头失败:"+o,icon:"none",duration:2e3})})},comfirmModal:function(t){switch(this.toShowModal=!1,this.currentAction){case"preSubmitDataList":this.submitDataList();break;case"preSelectHoverport":this.handleDataWhenGotHoverport();break;case"preCompetitionForOrders":this.scanCard={},this.loadFirstCarGoodsNo();break;default:break}},cancelModal:function(t){this.toShowModal=!1},getTableHeight:function(){var t=s(r.default.mark(function t(){var o,e,n,a;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return o=this,e=o.setTableHeight(),t.next=4,o.getOtherContentHeight("elForm");case 4:return n=t.sent,t.next=7,o.getOtherContentHeight("elBtn");case 7:a=t.sent,null!=n&&null!=a&&(o.tableHeight=e-n-a-20);case 9:case"end":return t.stop()}},t,this)}));function o(){return t.apply(this,arguments)}return o}(),spFreshCarListForAPP:function(){if(""!=this.formItem.hoverport){var o=this;if(""!=this.formItem.cardBoardNo){var e=""+this.formItem.cardBoardNo;if(this.scanCard[e])return t.showToast({title:"".concat(this.formItem.cardBoardNo,"卡板号已经被扫描了"),icon:"none",duration:2e3}),void(this.formItem.cardBoardNo="");var r={procName:"spScanInfoForAPP",params:{UserID:this.$store.getters.userInfo_getters,CardNo:this.formItem.cardBoardNo,CarListNo:this.formItem.carGoodsNo,Type:"A"}};this.$store.dispatch("getExecuteDropDownAction",r).then(function(r){r&&r.list&&r.list.length>0&&(1===r.list[0].Error?t.showToast({title:"扫描失败:"+r.list[0].Result,icon:"none",duration:2e3}):(o.loadDataByUser(),o.formItem.cardBoardNo="",o.scanCard[e]="A",t.showToast({title:"扫描成功",icon:"none",duration:2e3})))}).catch(function(o){t.showToast({title:"更新扫描数量失败:"+o,icon:"none",duration:2e3})})}}else t.showToast({title:"请先选择码头",icon:"none",duration:2e3})},_spFreshCarListForAPP:function(){var o=this;if(""!=this.formItem.cardBoardNo){var e=""+this.formItem.cardBoardNo;if(this.scanCard[e])return t.showToast({title:"".concat(this.formItem.cardBoardNo,"卡板号已经被扫描了"),icon:"none",duration:2e3}),void(this.formItem.cardBoardNo="");var r={procName:"spFreshCarListForAPP",params:{UserID:this.$store.getters.userInfo_getters,CardNo:this.formItem.cardBoardNo}};this.$store.dispatch("getExecuteDropDownAction",r).then(function(t){o.cardScanQtyItems[o.formItem.cardBoardNo]=JSON.parse(JSON.stringify(t.list)),t.list.forEach(function(t,e){var r=t.OrderNo;if(null!=o.cardBoardNoInfoClone[r]){var n=o.cardBoardNoInfoClone[r].ScanQty;o.cardBoardNoInfoClone[t.OrderNo].ScanQty=n+t.Qty,o.cardBoardNoInfoClone[t.OrderNo]["CardNo"]=o.formItem.cardBoardNo}}),o.formItem.cardBoardNo="",o.scanCard[e]="A",o.checkIsDoneOrNot()}).catch(function(t){})}},turnOnScanCode:function(o){this.scanType=o;var e=this;t.scanCode({scanType:"barCode",success:function(t){switch(o){case"cardBoardNo":e.formItem.cardBoardNo=t.result,e.spFreshCarListForAPP();break;default:break}}})}}};o.default=m}).call(this,e("6e42")["default"])},"0e1d":function(t,o,e){"use strict";var r,n=function(){var t=this,o=t.$createElement;t._self._c},a=[];e.d(o,"b",function(){return n}),e.d(o,"c",function(){return a}),e.d(o,"a",function(){return r})},"485b":function(t,o,e){},"487d":function(t,o,e){"use strict";(function(t){e("628f"),e("921b");r(e("66fd"));var o=r(e("c09d"));function r(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,e("6e42")["createPage"])},c09d:function(t,o,e){"use strict";e.r(o);var r=e("0e1d"),n=e("cb58");for(var a in n)"default"!==a&&function(t){e.d(o,t,function(){return n[t]})}(a);e("dce2");var i,s=e("f0c5"),c=Object(s["a"])(n["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],i);o["default"]=c.exports},cb58:function(t,o,e){"use strict";e.r(o);var r=e("0684"),n=e.n(r);for(var a in r)"default"!==a&&function(t){e.d(o,t,function(){return r[t]})}(a);o["default"]=n.a},dce2:function(t,o,e){"use strict";var r=e("485b"),n=e.n(r);n.a}},[["487d","common/runtime","common/vendor"]]]);