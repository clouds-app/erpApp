(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cardBoard/outStorage/outStorage"],{"0dc8":function(t,o,e){"use strict";e.r(o);var n=e("0e46"),a=e("392c");for(var r in a)"default"!==r&&function(t){e.d(o,t,function(){return a[t]})}(r);e("9491");var i,s=e("f0c5"),c=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],i);o["default"]=c.exports},"0e46":function(t,o,e){"use strict";var n,a=function(){var t=this,o=t.$createElement;t._self._c;t._isMounted||(t.e0=function(o){t.appendModalShow=!0})},r=[];e.d(o,"b",function(){return a}),e.d(o,"c",function(){return r}),e.d(o,"a",function(){return n})},"2eb6":function(t,o,e){},"392c":function(t,o,e){"use strict";e.r(o);var n=e("f967"),a=e.n(n);for(var r in n)"default"!==r&&function(t){e.d(o,t,function(){return n[t]})}(r);o["default"]=a.a},9491:function(t,o,e){"use strict";var n=e("2eb6"),a=e.n(n);a.a},"9db7":function(t,o,e){"use strict";(function(t){e("628f"),e("921b");n(e("66fd"));var o=n(e("0dc8"));function n(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,e("6e42")["createPage"])},f967:function(t,o,e){"use strict";(function(t,n){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var a=s(e("a34a")),r=s(e("2464")),i=e("2f62");function s(t){return t&&t.__esModule?t:{default:t}}function c(t,o,e,n,a,r,i){try{var s=t[r](i),c=s.value}catch(d){return void e(d)}s.done?o(c):Promise.resolve(c).then(n,a)}function d(t){return function(){var o=this,e=arguments;return new Promise(function(n,a){var r=t.apply(o,e);function i(t){c(r,n,a,i,s,"next",t)}function s(t){c(r,n,a,i,s,"throw",t)}i(void 0)})}}function u(t){for(var o=1;o<arguments.length;o++){var e=null!=arguments[o]?arguments[o]:{},n=Object.keys(e);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.forEach(function(o){l(t,o,e[o])})}return t}function l(t,o,e){return o in t?Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[o]=e,t}var h=function(){return e.e("components/color-ui-dialog/color-ui-dialog").then(e.bind(null,"43f7"))},f=function(){return Promise.all([e.e("common/vendor"),e.e("components/z-table/z-table")]).then(e.bind(null,"717c"))},p=function(){return e.e("components/uni-icon/uni-icon").then(e.bind(null,"6203"))},g=function(){return e.e("components/searchForm/searchDataList.vue").then(e.bind(null,"a99d"))},m=function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"ad32"))},N={cardBoardNo:"",carGoodsNo:""},I={name:"inStorage",mixins:[r.default],components:{zTable:f,searchForm:g,uniPopup:m,uniIcon:p,alertBox:h},data:function(){return{missingInsertList:[],appendModel:{OrderNo:""},appendRow:{},appendModalShow:!1,appendOkBtnDisabled:!0,scanCard:{},currentAction:"",currentSelectId:"",currentSelectItem:{},currentSelect:"carNoList",dataSource:[],toShowModal:!1,msgContent:"",scanType:"",tableHeight:400,carNoList:[],errorContent:"暂无数据",cardBoardNoInfoData:[],cardBoardNoInfoClone:{},cardBoardNoInfoColumns:[{key:"OrderNo",title:"工单号",width:180},{key:"StationNo",title:"库位",width:100},{key:"Qty",title:"需装数",width:100},{key:"ScanQty",title:"扫描数",width:100},{key:"CustName",title:"客户",width:180},{key:"ArtID",title:"纸质",width:160},{key:"Size",title:"规格",width:160},{key:"MinSize",title:"小尺寸",width:160},{key:"ZoneName",title:"地区",width:100},{title:"操作",listenerClick:!0,width:80,titleAlign:"center",columnAlign:"center",format:{template:"详细",names:[]}}],formItem:Object.assign({},N),catchFlag:!1,cardScanQtyItems:{}}},watch:{cardBoardNoInfoData:{handler:function(t,o){},deep:!0}},mounted:function(){var o=this;t.$on("outInCarListUpdate",function(t){o.cardBoardNoInfoClone[t.orderNo]&&(o.cardBoardNoInfoClone[t.orderNo].ScanQty=t.scanQty)}),this.messageRegister(),this.getTableHeight()},onReady:function(){this.messageRegister(),this.getTableHeight()},methods:u({getWorkNoInfo:function(){},goToOtherPage:function(){if(""==this.formItem.carGoodsNo)t.showToast({title:"请先选择需要操作的装车单号",icon:"none",duration:2e3});else{var o="outInCarList";try{t.removeStorageSync(o)}catch(a){return this.catchFlag=!1,void console.log(n(a," at pages\\cardBoard\\outStorage\\outStorage.vue:232"))}try{var e=this;t.setStorage({key:o,data:e.cardBoardNoInfoData,success:function(){e.catchFlag=!0}})}catch(a){this.catchFlag=!1}if(!this.catchFlag)return void t.showToast({title:"数据缓存失败,请稍后再试!",icon:"none",duration:2e3});t.navigateTo({url:"./outStorageEdit?carListNo="+this.formItem.carGoodsNo})}},moreDetail:function(){t.navigateTo({url:"./outStorageDetail?carListNo="+this.formItem.carGoodsNo})},onClickCheck:function(t){},onClickRowEvent:function(o){console.log(n(o," at pages\\cardBoard\\outStorage\\outStorage.vue:276"));var e="cardQtyListCache";try{t.removeStorageSync(e)}catch(r){return this.catchFlag=!1,void console.log(n(r," at pages\\cardBoard\\outStorage\\outStorage.vue:289"))}try{var a=this;t.setStorage({key:e,data:JSON.stringify(a.cardScanQtyItems),success:function(){}})}catch(r){console.log(n(r," at pages\\cardBoard\\outStorage\\outStorage.vue:301"))}t.navigateTo({url:"./outStorageDetail?orderNo=".concat(o.OrderNo,"&cardNo=").concat(o.CardNo,"&scanQty=").concat(o.ScanQty,"&cacheKey=").concat(e)})},deleteDetailItem:function(o){var e={id:o};this.$store.dispatch("delateStockUpDetailedAction",e).then(function(o){t.showToast({title:"删除成功!",icon:"none",duration:2e3})}).catch(function(o){t.showToast({title:"删除失败:"+o,icon:"none",duration:2e3})})},getCardBoardNoInfo:function(){var o=this;if(this.cardBoardNoInfoData=[],""!=this.formItem.carGoodsNo){var e={procName:"spGetPaperCarListInfoForAPP",params:{UserID:this.$store.getters.userInfo_getters,CarListNo:this.formItem.carGoodsNo}};this.dataIsLoadding=!0,this.getExecuteDropDownDetailsAction(e).then(function(e){e&&e.list.length>0?(o.cardBoardNoInfoData=e.list,o.formItem.originalKuNo=o.cardBoardNoInfoData[0].ap_StationNo,o.cardBoardNoInfoData.forEach(function(t,e){o.cardBoardNoInfoClone[t.OrderNo]=t})):t.showToast({title:"没有该卡板对应的数据",icon:"none",duration:2e3}),o.dataIsLoadding=!1}).catch(function(e){t.showToast({title:"获取清单数据失败:"+e,icon:"none",duration:2e3}),o.dataIsLoadding=!1})}else t.showToast({title:"请选择装车单号",icon:"none",duration:2e3})},getSelectDataInfo:function(t){switch(this.currentSelect){case"carNoList":this.formItem.carGoodsNo=t.ct_Desc,this.getCardBoardNoInfo();break;default:break}this.scanCard={},this.missingInsertList=[]},getCarGoodsNo:function(){this.$refs["searchForm"].isShowSearchList=!0,this.$refs["searchForm"].dataSourceList=this.carNoList,this.dataSource=this.carNoList},loadCarGoodsNoList:function(){this.carNoList=[];var o={procName:"spGetLoadCarNoListForAPP",params:{UserID:this.$store.getters.userInfo_getters}},e=this;this.$store.dispatch("getExecuteDropDownAction",o).then(function(t){if(t&&t.list&&t.list.length>0){var o=t.list.map(function(t){var o={type:t.LoadNo,ct_Desc:t.LoadNo};return o});e.carNoList=o}}).catch(function(o){t.showToast({title:"加载装车单号列表失败:"+o,icon:"none",duration:2e3})})},comfirmModal:function(t){switch(this.toShowModal=!1,this.currentAction){case"preSubmitDataList":this.submitAddList();break;case"deleteDetailItem":this.deleteDetailItem(this.currentSelectItem.ap_OrderNo);break;default:break}},cancelModal:function(t){this.toShowModal=!1},preSubmitDataList:function(){this.currentAction="preSubmitDataList",this.msgContent="确定提交数据吗?",this.toShowModal=!0},submitAddList:function(){var o=this,e={newStationNo:this.formItem.kuNo,StationNo:this.cardBoardNoInfoData[0].ap_StationNo};this.$store.dispatch("setStationNoAction",e).then(function(e){o.formItem=Object.assign({},defalutformItem),o.cardBoardNoInfoData=[],t.showToast({title:"操作成功",icon:"none",duration:2e3})}).catch(function(o){t.showToast({title:"操作失败:"+o,icon:"none",duration:2e3})})},getTableHeight:function(){var t=d(a.default.mark(function t(){var o,e,n,r;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return o=this,e=o.setTableHeight(),t.next=4,o.getOtherContentHeight("elForm");case 4:return n=t.sent,t.next=7,o.getOtherContentHeight("elBtn");case 7:r=t.sent,null!=n&&null!=r&&(o.tableHeight=e-n-r-20);case 9:case"end":return t.stop()}},t,this)}));function o(){return t.apply(this,arguments)}return o}()},(0,i.mapActions)(["getExecuteDropDownDetailsAction","getStorageOrderDetailAction"]),{messageRegister:function(){this.$store.commit("setOutStorageDetailsList",[]),this.loadCarGoodsNoList()},getcardBoarDetailList:function(){var o={procName:"spFreshCarListForAPP",params:{CardNo:this.formItem.cardBoardNo,UserID:this.$store.getters.userInfo_getters,CarListNo:this.formItem.carGoodsNo}};this.$store.dispatch("getExecuteDropDownAction",o).then(function(o){t.showToast({title:"更新明细成功,请稍后...",icon:"none",duration:2e3})}).catch(function(o){t.showToast({title:"抱歉,更新明细失败:"+o,icon:"none",duration:2e3})})},turnOnScanCode:function(o){this.scanType=o;var e=this;t.scanCode({scanType:"barCode",success:function(t){switch(console.log(n("条码内容："+t.result," at pages\\cardBoard\\outStorage\\outStorage.vue:538")),o){case"cardBoardNo":e.formItem.cardBoardNo=t.result,e.spFreshCarListForAPP();break;case"OrderNo":e.appendModel.OrderNo=t.result;break;default:break}}})},getStorageOrderDetail:function(){var o=this;""!=this.appendModel.OrderNo&&this.$store.dispatch("getStorageOrderDetailAction",this.appendModel).then(function(e){e.list.length>0?(o.appendRow=e.list[0],o.appendOkBtnDisabled=!1):(o.appendModel.OrderNo="",t.showToast({title:"该工单没有对应的信息",icon:"none",duration:2e3}))}).catch(function(o){t.showToast({title:"抱歉,工单明细获取失败,请稍后再试",icon:"none",duration:2e3})})},appendRowToList:function(){var o=this;if(0!=Object.keys(this.appendRow).length){var e=this.cardBoardNoInfoData.find(function(t){return t.OrderNo==o.appendModel.OrderNo});e?t.showToast({title:"工单已在当前列表中存在",icon:"none",duration:2e3}):(this.bindingMissingDataToAppendList(),this.cardBoardNoInfoClone[this.appendRow.OrderNo]=this.appendRow,this.cardBoardNoInfoData.push(this.appendRow)),this.closeAppendModal()}else t.showToast({title:"请输入工单号,稍等片刻",icon:"none",duration:2e3})},bindingMissingDataToAppendList:function(){var t=this;this.missingInsertList.length>0&&this.missingInsertList.map(function(o){o.OrderNo==t.appendRow.OrderNo&&(t.appendRow.ScanQty=o.Qty)})},closeAppendModal:function(){this.appendRow={},this.appendModel.OrderNo="",this.appendOkBtnDisabled=!0,this.appendModalShow=!1},spFreshCarListForAPP:function(){var o=this;if(""!=this.formItem.cardBoardNo){var e=""+this.formItem.cardBoardNo;if(this.scanCard[e])return t.showToast({title:"".concat(this.formItem.cardBoardNo,"卡板号已经被扫描了"),icon:"none",duration:2e3}),void(this.formItem.cardBoardNo="");var n={procName:"spFreshCarListForAPP",params:{UserID:this.$store.getters.userInfo_getters,CardNo:this.formItem.cardBoardNo}};this.$store.dispatch("getExecuteDropDownAction",n).then(function(t){o.cardScanQtyItems[o.formItem.cardBoardNo]=JSON.parse(JSON.stringify(t.list)),t.list.forEach(function(t,e){var n=t.OrderNo;if(null!=o.cardBoardNoInfoClone[n]){var a=o.cardBoardNoInfoClone[n].ScanQty;o.cardBoardNoInfoClone[t.OrderNo].ScanQty=a+t.Qty,o.cardBoardNoInfoClone[t.OrderNo]["CardNo"]=o.formItem.cardBoardNo}else o.missingInsertList.push(t)}),o.formItem.cardBoardNo="",o.scanCard[e]="A"}).catch(function(t){})}}})};o.default=I}).call(this,e("6e42")["default"],e("0de9")["default"])}},[["9db7","common/runtime","common/vendor"]]]);